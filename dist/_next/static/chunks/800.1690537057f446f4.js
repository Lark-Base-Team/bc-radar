"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[800],{800:function(e,t,l){l.r(t),l.d(t,{default:function(){return ec}});var i=l(433);class o{size(){return this.events.size}emitSync(){for(var e=arguments.length,t=Array(e),l=0;l<e;l++)t[l]=arguments[l];let i=[];return this.events.forEach(e=>{var l;let o=null!==(l=e.lastCall)&&void 0!==l?l:0,r=e.interval;Date.now()-o<r||(e.lastCall=Date.now(),i.push(e(...t)))}),i}emitLifeCycle(){for(var e=arguments.length,t=Array(e),l=0;l<e;l++)t[l]=arguments[l];return this.lastEmitArgs=t,Promise.resolve().then(()=>{try{this.emitSync(...t)}catch(e){return Promise.reject(e)}})}emit(){for(var e=arguments.length,t=Array(e),l=0;l<e;l++)t[l]=arguments[l];return new Promise(e=>{this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{try{this.emitSync(...t),e()}catch(e){return Promise.reject(e)}},this.debounce)})}on(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.interval=t,this.lastEmitArgs&&e(...this.lastEmitArgs),this.events.add(e),()=>{this.off(e)}}wait(){return new Promise(e=>{let t=this.on(function(){for(var l=arguments.length,i=Array(l),o=0;o<l;o++)i[o]=arguments[o];e(i),t()})})}off(e){this.events.delete(e)}destroy(){this.events.clear()}constructor(e){this.debounce=e,this.events=new Set}}var r=l(9968),a=l(5271);class n{saveConfig(e){return this.bitable.dashboard.saveConfig(e)}getConfig(){return this.bitable.dashboard.getConfig()}getData(){return this.bitable.dashboard.getData()}getPreviewData(e){return this.bitable.dashboard.getPreviewData(e)}getDashState(){return this.bitable.dashboard.state}triggerDashRendered(){return this.bitable.dashboard.setRendered()}async getRecordIds(e){return e||(e=await this.getActiveTable()),await e.getRecordIdList()}async getRecordById(e,t){return await e.getRecordById(t)}async getActiveTable(){return this.activeTable||(this.activeTable=await i.ws.base.getActiveTable()),this.activeTable}async getTableList(){return await Promise.all((await i.ws.base.getTableList()).map(async e=>{let t=await e.getName();return{id:e.id,name:t,raw:e}}))}async getViewList(e){var t;let l=await this.getTableById(e),i=await (null===(t=l.raw)||void 0===t?void 0:t.getViewList())||[];return await Promise.all(i.map(async e=>{let t=await e.getName();return{id:e.id,name:t,raw:e}}))}async getTableById(e){let t=await i.ws.base.getTableById(e);return{id:t.id,name:await t.getName(),raw:t}}async getFiledListByViewId(e,t){var l,i;let o=await this.getTableById(e),r=await (null===(l=o.raw)||void 0===l?void 0:l.getViewById(t));return(null!==(i=await (null==r?void 0:r.getFieldMetaList()))&&void 0!==i?i:[]).map(e=>({name:e.name,id:e.id,type:e.type,raw:e}))}async getSelection(){return await i.ws.base.getSelection()}async getSelectionQuery(e){let t=e.tableId?await this.base.getTableById(e.tableId):void 0;return{table:t,view:e.viewId?await (null==t?void 0:t.getViewById(e.viewId)):void 0,field:e.fieldId?await (null==t?void 0:t.getFieldById(e.fieldId)):void 0,record:e.recordId?await (null==t?void 0:t.getRecordById(e.recordId)):void 0}}async getSelection2(){let{viewId:e=!1,fieldId:t=!1,recordId:l=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=await this.getSelection();return await this.getSelectionQuery({viewId:e?i.viewId:void 0,fieldId:t?i.fieldId:void 0,recordId:l?i.recordId:void 0})}async getRecordList(e,t){let l;let i=[];for(;;){let o=await e.getRecords({pageSize:5e3,...t,pageToken:l});if(i.push(...o.records),l=o.pageToken,!o.hasMore)break}return i}async getDisplayRecordList(e,t,l){let o=await this.getRecordList(e,l);console.log("fields:",t);let a=[];for(let e=0;e<o.length;e++){let l=o[e];a.push({_id:l.recordId,...function(e,t){let l={};return e.forEach(e=>{var o,a,n,s;let d=t.fields[e.id];e.type===i.fS.DateTime&&"dateFormat"in e.property&&d?(l[e.id]=(0,r.Z)(d,null===(o=e.property)||void 0===o?void 0:o.dateFormat),l["ts_"+e.name]=d):e.type===i.fS.Url&&d?l[e.id]=null===(a=d[0])||void 0===a?void 0:a.link:l[e.id]="object"==typeof d?null!==(s=null==d?void 0:d.text)&&void 0!==s?s:null==d?void 0:null===(n=d.map)||void 0===n?void 0:n.call(d,e=>{var t;return null!==(t=null==e?void 0:e.text)&&void 0!==t?t:null==e?void 0:e.name}).filter(e=>e).join(","):d,l._raw_=t.fields}),l}(t,l)})}return a}constructor({onSelectionChange:e=!1,immediatelySelectionChange:t=!0,onDashDataChange:l=!1,onDashConfigChange:r=!1}={}){this.bitable=i.ws,this.base=i.ws.base,this.emSelectionChange=new o,this.emDashDataChange=new o(1500),this.emDashConfigChange=new o(1500),e&&this.base.onSelectionChange(async e=>{this.activeTable=void 0,this.emSelectionChange.emitLifeCycle(e)}),t&&e&&this.getSelection().then(e=>{this.emSelectionChange.emitSync({data:e})}),l&&this.bitable.dashboard.onDataChange(e=>{this.emDashDataChange.emit(e)}),r&&this.bitable.dashboard.onConfigChange(e=>{this.emDashConfigChange.emit(e)})}}let s=new n({onDashDataChange:!0,onDashConfigChange:!0});var d=l(2676),c=l(6133),u=l(2215);let f=[{label:["#2e65d1","#50cefb","#935af6","#fad355","#f54a45","#ffa53d"],value:"p1"},{label:["#2e65d1","#50cefb","#14e1c6","#62d256","#c3dd40","#fad355"],value:"p2"},{label:["#3370ff","#f80","#50cefb","#fad355","#62d256","#8f959e"],value:"p3"},{label:["rgb(83,131,241)","rgb(235,107,103)","rgb(187,191,196)","rgb(58,92,169)","rgb(165,75,72)","rgb(31,215,191)"],value:"p4"},{label:["#2e65d1","#f54a45","#8f959e","#4954e6","#00d6b9","#935af6"],value:"p5"},{label:["#bacefd","#d9f3fd","#14e1c6","#62d256","#eef6c6","#f8e6ab"],value:"p6"},{label:["#0f8575","#10a893","#3370eb","#a575fa","#8c55ec","#6c39c6"],value:"p7"},{label:["#1099cc","#4c88ff","#2655b6","#fc94cf","#ed77ba","#c24a8e"],value:"p8"},{label:["rgb(15,87,255)","rgb(43,107,255)","rgb(71,126,255)","rgb(99,146,255)","rgb(128,166,255)","rgb(184,205,255)"],value:"p9"},{label:["rgb(20,192,255)","rgb(48,200,255)","rgb(75,207,255)","rgb(102,214,255)","rgb(129,221,255)","rgb(184,236,255)"],value:"p10"},{label:["rgb(52, 199, 35)","rgb(69, 219, 53)","rgb(99, 225, 84)","rgb(128, 231, 116)","rgb(157, 236, 148)","rgb(215, 247, 212)"],value:"p11"},{label:["rgb(255,198,10)","rgb(255,203,34)","rgb(255,209,58)","rgb(255,215,82)","rgb(255,220,105)","rgb(255,231,153)"],value:"p12"},{label:["rgb(255,136,0)","rgb(255,149,29)","rgb(255,163,58)","rgb(255,176,87)","rgb(255,190,116)","rgb(255,217,173)"],value:"p13"},{label:["rgb(255,23,15)","rgb(255,50,43)","rgb(255,78,71)","rgb(255,105,99)","rgb(255,132,128)","rgb(255,186,184)"],value:"p14"},{label:["rgb(0,0,0)","rgb(34,34,34)","rgb(68,68,68)","rgb(102,102,102)","rgb(136,136,136)","rgb(204,204,204)"],value:"p15"}];var p=e=>{let t=f.find(t=>t.value===e);return{color:null==t?void 0:t.label,backgroundColor:"rgba(255,255,255,0)",textStyle:{},title:{textStyle:{color:"#ffffff"},subtextStyle:{color:"#dddddd"}},line:{itemStyle:{borderWidth:"4"},lineStyle:{width:"3"},symbolSize:"0",symbol:"circle",smooth:!0},radar:{itemStyle:{borderWidth:"4"},lineStyle:{width:"3"},symbolSize:"0",symbol:"circle",smooth:!0},bar:{itemStyle:{barBorderWidth:0,barBorderColor:"#ccc"}},pie:{itemStyle:{borderWidth:0,borderColor:"#ccc"}},scatter:{itemStyle:{borderWidth:0,borderColor:"#ccc"}},boxplot:{itemStyle:{borderWidth:0,borderColor:"#ccc"}},parallel:{itemStyle:{borderWidth:0,borderColor:"#ccc"}},sankey:{itemStyle:{borderWidth:0,borderColor:"#ccc"}},funnel:{itemStyle:{borderWidth:0,borderColor:"#ccc"}},gauge:{itemStyle:{borderWidth:0,borderColor:"#ccc"}},candlestick:{itemStyle:{color:"#fc97af",color0:"transparent",borderColor:"#fc97af",borderColor0:"#87f7cf",borderWidth:"2"}},graph:{itemStyle:{borderWidth:0,borderColor:"#ccc"},lineStyle:{width:"1",color:"#ffffff"},symbolSize:"0",symbol:"circle",smooth:!0,color:["#fc97af","#87f7cf","#f7f494","#72ccff","#f7c5a0","#d4a4eb","#d2f5a6","#76f2f2"],label:{color:"#293441"}},map:{itemStyle:{areaColor:"#f3f3f3",borderColor:"#999999",borderWidth:.5},label:{color:"#893448"},emphasis:{itemStyle:{areaColor:"rgba(255,178,72,1)",borderColor:"#eb8146",borderWidth:1},label:{color:"rgb(137,52,72)"}}},geo:{itemStyle:{areaColor:"#f3f3f3",borderColor:"#999999",borderWidth:.5},label:{color:"#893448"},emphasis:{itemStyle:{areaColor:"rgba(255,178,72,1)",borderColor:"#eb8146",borderWidth:1},label:{color:"rgb(137,52,72)"}}},categoryAxis:{axisLine:{show:!0,lineStyle:{color:"#666666"}},axisTick:{show:!1,lineStyle:{color:"#333"}},axisLabel:{show:!0,color:"#aaaaaa"},splitLine:{show:!1,lineStyle:{color:["#e6e6e6"]}},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.05)","rgba(200,200,200,0.02)"]}}},valueAxis:{axisLine:{show:!0,lineStyle:{color:"#666666"}},axisTick:{show:!1,lineStyle:{color:"#333"}},axisLabel:{show:!0,color:"#aaaaaa"},splitLine:{show:!1,lineStyle:{color:["#e6e6e6"]}},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.05)","rgba(200,200,200,0.02)"]}}},logAxis:{axisLine:{show:!0,lineStyle:{color:"#666666"}},axisTick:{show:!1,lineStyle:{color:"#333"}},axisLabel:{show:!0,color:"#aaaaaa"},splitLine:{show:!1,lineStyle:{color:["#e6e6e6"]}},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.05)","rgba(200,200,200,0.02)"]}}},timeAxis:{axisLine:{show:!0,lineStyle:{color:"#666666"}},axisTick:{show:!1,lineStyle:{color:"#333"}},axisLabel:{show:!0,color:"#aaaaaa"},splitLine:{show:!1,lineStyle:{color:["#e6e6e6"]}},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.05)","rgba(200,200,200,0.02)"]}}},toolbox:{iconStyle:{borderColor:"#999999"},emphasis:{iconStyle:{borderColor:"#666666"}}},legend:{textStyle:{color:"#999999"}},tooltip:{axisPointer:{lineStyle:{color:"#cccccc",width:1},crossStyle:{color:"#cccccc",width:1}}},timeline:{lineStyle:{color:"#87f7cf",width:1},itemStyle:{color:"#87f7cf",borderWidth:1},controlStyle:{color:"#87f7cf",borderColor:"#87f7cf",borderWidth:.5},checkpointStyle:{color:"#fc97af",borderColor:"#fc97af"},label:{color:"#87f7cf"},emphasis:{itemStyle:{color:"#f7f494"},controlStyle:{color:"#87f7cf",borderColor:"#87f7cf",borderWidth:.5},label:{color:"#87f7cf"}}},visualMap:{color:["#fc97af","#87f7cf"]},dataZoom:{backgroundColor:"rgba(255,255,255,0)",dataBackgroundColor:"rgba(114,204,255,1)",fillerColor:"rgba(114,204,255,0.2)",handleColor:"#72ccff",handleSize:"100%",textStyle:{color:"#333333"}},markPoint:{label:{color:"#293441"},emphasis:{label:{color:"#293441"}}}}},h=(0,u.OU)(function(e){let{option:t,width:l}=e,i=(0,a.useRef)(null),o=(0,a.useRef)();return(0,a.useEffect)(()=>{console.log("theme",p(t.theme),t.theme);let l=c.S1(i.current,p(t.theme));return l.setOption(t),e.refInstance&&(e.refInstance.current=l),o.current=l,()=>{l.dispose()}},[t,e.refInstance]),(0,a.useEffect)(()=>{o.current&&o.current.resize()},[l]),(0,d.jsx)("div",{ref:i,style:{width:"100%",height:"100%"}})});function v(e,t){var l,i,o,r,a,n,s,d;let c={theme:t.selectTheme};if("fieldCategory"===t.mapType){let s={...c,legend:g(t.chartOptions.includes("showLegend"),{data:null===(o=e[0])||void 0===o?void 0:null===(i=o.slice(1))||void 0===i?void 0:null===(l=i.map)||void 0===l?void 0:l.call(i,e=>e.text)}),radar:{indicator:e.slice(1).map(e=>({name:e[0].text}))},series:[{name:"Data",type:"radar",data:null===(n=e[0])||void 0===n?void 0:null===(a=n.slice(1))||void 0===a?void 0:null===(r=a.map)||void 0===r?void 0:r.call(a,(l,i)=>({value:e.slice(1).map(e=>e[i+1].value),name:l.text,label:g(t.chartOptions.includes("showDataLabel"),{show:!0})}))}]};return console.log("echartsOption",s),s}{let l={...c,legend:g(t.chartOptions.includes("showLegend"),{data:e.slice(1).map(e=>e[0].text)}),radar:{indicator:null===(d=e[0])||void 0===d?void 0:null===(s=d.slice(1))||void 0===s?void 0:s.map(e=>({name:e.text}))},series:[{name:"Data",type:"radar",data:e.slice(1).map(e=>({value:e.slice(1).map(e=>e.value),name:e[0].text,label:g(t.chartOptions.includes("showDataLabel"),{show:!0})}))}]};return console.log("echartsOption2",l),l}}function g(e,t){return e?t:void 0}function b(e){let[t,l]=(0,a.useState)({});async function i(e){let t=await s.getConfig(),i=await s.getData();console.log("getPreviewData",t,i,e),l(v(i,t.customConfig)),s.triggerDashRendered()}return(0,a.useEffect)(()=>{i();let e=[];return e.push(s.emDashConfigChange.on(i)),e.push(s.emDashDataChange.on(i)),()=>{e.forEach(e=>e())}},[]),(0,d.jsx)("div",{style:{width:"100%",height:"100vh"},children:(0,d.jsx)(h,{option:t})})}var m=l(1678),y=l(2349);function x(e){let{field:t,label:l,default:i,value:o,tip:r,onChange:n,target:s,options:c}=e,u=(0,a.useRef)();return(0,d.jsxs)("div",{style:{paddingTop:"10px"},children:[(0,d.jsx)("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#333"},children:l}),(0,d.jsx)(y.II,{style:{marginTop:"5px"},ref:u,defaultValue:i,value:o,type:"text",onChange:e=>n(s,t,e)}),(0,d.jsx)("div",{style:{fontSize:"12px",marginTop:"2px",color:"#666"},children:r})]})}function w(e){var t,l;let{field:i,label:o,default:r,value:a,tip:n,onChange:s,target:c,options:u}=e,f=(null==u?void 0:null===(l=u.find)||void 0===l?void 0:null===(t=l.call(u,e=>e.key===(null==a?void 0:a.key)))||void 0===t?void 0:t.value)||[];return(0,d.jsxs)("div",{style:{paddingTop:"10px"},children:[(0,d.jsx)("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#333"},children:o}),(0,d.jsx)(y.Ph,{value:(null==a?void 0:a.key)||r,style:{marginTop:5,width:"100%"},optionList:null==u?void 0:u.map(e=>({label:e.label,value:e.key})),onChange:e=>{var t;let l=Object.assign({},c[i]);l.key=e;let o=(null==u?void 0:null===(t=u.find(t=>t.key===e))||void 0===t?void 0:t.value)||[];l.value=et({type:"object",field:"",properties:o}),s(c,i,l)}}),(0,d.jsx)("div",{style:{fontSize:"12px",marginTop:"2px",color:"#666"},children:n}),(0,d.jsx)("div",{style:{marginTop:"0px"},children:(0,d.jsx)(eo,{field:"",value:null==a?void 0:a.value,target:null==a?void 0:a.value,onChange:(e,t,l)=>{a.value[t]=l,s(c,i,a)},properties:f})})]})}var S=l(4489),C=l(6321);function j(){let e=(0,S._)(["\n  display: flex;\n  height: 100%;\n  width: 100%;\n"]);return j=function(){return e},e}function I(){let e=(0,S._)(["\n  height: 100%;\n  width: 30px;\n  border: 0;\n  margin: 0;\n  padding: 0;\n\n  &:first-child {\n    border-radius: 4px 0 0 4px;\n  }\n  &:last-child {\n    border-radius: 0 4px 4px 0;\n  }\n"]);return I=function(){return e},e}function T(e){let{field:t,label:l,default:i,value:o,tip:r,onChange:a,target:n,options:s}=e;return(0,d.jsxs)("div",{style:{paddingTop:"10px"},children:[(0,d.jsx)("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#333"},children:l}),(0,d.jsx)(y.Ph,{placeholder:"请选择主题色",style:{width:"100%",marginTop:"5px"},onChange:e=>{a(n,t,e)},value:o,renderSelectedItem:e=>{var t;let l=(null==s?void 0:null===(t=s.find(t=>t.value===e.value))||void 0===t?void 0:t.label)||[];return(0,d.jsx)(R,{style:{height:15},items:l})},renderOptionItem:e=>{var t;let l=(null==s?void 0:null===(t=s.find(t=>t.value===e.value))||void 0===t?void 0:t.label)||[];return(0,d.jsx)("div",{style:{width:"97%",padding:"3px 8px",margin:"2px 5px",background:e.selected?"#f1f1fc":"",borderRadius:"4px"},onClick:e.onClick,children:(0,d.jsx)(R,{style:{height:15,width:"100%"},items:l})})},children:null==s?void 0:s.map((e,t)=>(0,d.jsx)(y.Ph.Option,{value:e.value},e.value))}),(0,d.jsx)("div",{style:{fontSize:"12px",marginTop:"2px",color:"#666"},children:r})]})}let k=C.ZP.div(j()),O=C.ZP.div(I());function R(e){let{items:t,style:l}=e;return(0,d.jsx)(k,{style:l,children:t.map(e=>(0,d.jsx)(O,{style:{background:e}},e))})}function L(e){let{field:t,label:l,default:i,value:o,tip:r,onChange:n,target:s,options:c}=e;return(0,a.useRef)(),(0,d.jsxs)("div",{style:{paddingTop:"10px"},children:[(0,d.jsx)("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#333"},children:l}),(0,d.jsx)(y.cO,{style:{marginTop:"5px"},options:c,direction:"horizontal","aria-label":r,value:o,onChange:e=>{s[t]=e,n(s,t,e)}}),(0,d.jsx)("div",{style:{fontSize:"12px",marginTop:"2px",color:"#666"},children:r})]})}function D(e){return(0,d.jsx)("div",{style:{paddingTop:"10px"},children:(0,d.jsx)(y.iz,{})})}var E=l(5437),A=l(1837),z=l(3404),P=l(6338),W=l(9442),N=l(5038),M=l(5499),F=l(9093),Z=l(1406);function B(e,t){if(!e)return t;let l=document.querySelector(e);return l?Z.createPortal(t,l):t}function V(e){let{field:t,label:l,default:i,value:o,tip:r,onChange:n,target:s,options:c,portal:u}=e;(0,a.useRef)();let[f,p]=(0,a.useState)(0);return(0,a.useEffect)(()=>{p(Date.now())},[]),f?B(u,(0,d.jsx)(y.Ph,{value:o,onChange:e=>{n(s,t,e)},triggerRender:e=>{let{value:t,...l}=e;return(0,d.jsx)("div",{style:{minWidth:"112",display:"flex",alignItems:"center",paddingLeft:8,marginRight:-8,borderRadius:3},children:(0,d.jsxs)("div",{style:{margin:4,whiteSpace:"nowrap",textOverflow:"ellipsis",flexGrow:1,overflow:"hidden",display:"flex",alignItems:"center"},children:[t.map(e=>e.label).join(" , "),(0,d.jsx)(F.Z,{style:{margin:"0 8px",flexShrink:0}})]})})},optionList:c})):(0,d.jsx)(d.Fragment,{})}function _(e){let{condition:t,children:l}=e;return t?l:null}function G(){let e=(0,S._)(["\n  /* margin-top: 10px; */\n  font-size: 14px;\n  height: 32px;\n  color: #1f2329;\n  display: flex;\n  align-items: center;\n  border: 1px solid #e1e3e6;\n  border-radius: 5px;\n  padding: 0 10px;\n  margin-top: 8px;\n"]);return G=function(){return e},e}function U(){let e=(0,S._)(["\n  padding: 8px 16px;\n  font-size: 14px;\n  color: #1f2329;\n  display: flex;\n  align-items: center;\n  cursor: pointer;\n  &:hover {\n    background-color: #f4f5f7;\n  }\n"]);return U=function(){return e},e}function J(e){var t;let[l]=(0,M.$G)(),{field:i,label:o,default:r=[],value:n,tip:s,onChange:c,target:u,options:f}=e,p=(null==f?void 0:f.list)||[],h=(null==f?void 0:f.itemSelectOptions)||[],v=p.reduce((e,t)=>(e[t.value]=t.label,e),{}),[g,b]=(0,a.useState)(!0),[m,x]=(0,a.useState)(!1),[w,S]=(0,a.useState)({}),[C,j]=(0,a.useState)(null==h?void 0:null===(t=h[0])||void 0===t?void 0:t.value);(0,a.useEffect)(()=>{var e;j(null==h?void 0:null===(e=h[0])||void 0===e?void 0:e.value)},[h]);let I=p.filter(e=>!(null==n?void 0:n.some(t=>t.value===e.value)));return(0,d.jsxs)("div",{style:{paddingTop:"10px"},children:[(0,d.jsxs)("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#333",display:"flex",alignItems:"center"},children:[(0,d.jsx)("div",{style:{flex:1},children:o}),(0,d.jsx)("div",{children:(0,d.jsx)(_,{condition:C,children:(0,d.jsx)(V,{field:"",value:C,target:void 0,options:h,onChange:function(e,t,l){j(l),c(u,i,n.map(e=>({value:e.value,select:l})))}})})})]}),(0,d.jsx)("div",{style:{marginTop:15},children:null==n?void 0:n.map(e=>{let{value:t,select:o}=e;return(0,d.jsxs)("div",{children:[(0,d.jsxs)(Q,{children:[(0,d.jsx)(E.Z,{style:{fontSize:12,color:"#646A73",marginRight:5}}),(0,d.jsx)("span",{style:{flex:1},children:v[t]}),(0,d.jsx)(_,{condition:h.length,children:(0,d.jsx)("span",{style:{fontSize:14,color:"#8F959E"},children:(0,d.jsx)(y.Ph,{value:o,onChange:e=>{c(u,i,n.map(l=>l.value===t?{value:t,select:e}:l))},triggerRender:e=>{var t;let{value:l}=e;return(0,d.jsx)("div",{children:null==l?void 0:null===(t=l[0])||void 0===t?void 0:t.label})},optionList:h})})}),(0,d.jsx)(y.J2,{showArrow:!0,arrowPointAtCenter:!0,position:"bottomRight",clickToHide:!0,style:{width:100,padding:0},content:(0,d.jsxs)("div",{children:[(0,d.jsx)($,{onClick:()=>{S({[t]:!0})},children:l("Update Field")}),(0,d.jsx)($,{onClick:()=>{u[i]=n.filter(e=>e.value!==t),c(u,i,u[i])},children:l("Remove Field")}),(0,d.jsx)($,{onClick:()=>{let e=n.map(e=>e.value).indexOf(t);if(e>0){let t=n[e];n[e]=n[e-1],n[e-1]=t,u[i]=n?[...n]:[],c(u,i,u[i])}},children:l("Up Field")}),(0,d.jsx)($,{onClick:()=>{let e=n.map(e=>e.value).indexOf(t);if(e<n.length-1){let t=n[e];n[e]=n[e+1],n[e+1]=t,u[i]=n?[...n]:[],c(u,i,u[i])}},children:l("Down Field")})]}),children:(0,d.jsx)(A.Z,{style:{fontSize:12,transform:"rotate(90deg)",color:"#646A73",marginLeft:5}})})]}),w[t]&&(0,d.jsx)(X,{list:I,onClickItem:e=>{u[i]=n.map(l=>l.value===t?{value:e,select:l.select}:l),c(u,i,u[i]),w[t]=!1,S({...w})},onClose:()=>{w[t]=!1,S({...w})}})]},t)})}),(0,d.jsxs)("div",{style:{marginTop:10,userSelect:"none"},children:[(0,d.jsx)(y.u,{content:(0,d.jsx)("article",{children:(0,d.jsx)("p",{children:l("only number field")})}),arrowPointAtCenter:!1,trigger:"custom",visible:m,children:(0,d.jsx)(N.Z,{link:!!(null==I?void 0:I.length),icon:(0,d.jsx)(z.Z,{style:{fontSize:14}}),style:{color:"#aaa"},onClick:()=>{(null==I?void 0:I.length)?b(!1):(x(!0),setTimeout(()=>{x(!1)},2e3))},children:"添加字段"})}),g||(0,d.jsx)(X,{list:I,onClickItem:(e,t)=>{var l,o;u[i]=n?[...n,{value:e,select:null!==(l=null==t?void 0:t.select)&&void 0!==l?l:C}]:[{value:e,select:null!==(o=null==t?void 0:t.select)&&void 0!==o?o:C}],c(u,i,u[i]),b(!0)},onClose:()=>{b(!0)}})]}),(0,d.jsx)("div",{style:{fontSize:"12px",marginTop:"2px",color:"#666"},children:s})]})}function X(e){let t=null==e?void 0:e.list,[l,i]=(0,a.useState)(""),o=(null==t?void 0:t.filter(e=>!l||e.label.includes(l)))||[];return(0,d.jsx)(y.Zb,{title:(0,d.jsx)(y.II,{prefix:(0,d.jsx)(P.Z,{}),suffix:(0,d.jsx)(W.Z,{onClick:()=>{var t;i(""),null===(t=e.onClose)||void 0===t||t.call(e)}}),showClear:!1,borderless:!0,style:{borderWidth:0},placeholder:"搜索字段",autoFocus:!0,onChange:e=>{i(e)}}),shadows:"always",style:{marginTop:5},headerStyle:{padding:0},bodyStyle:{padding:0},children:null==o?void 0:o.map(t=>(0,d.jsxs)(Q,{style:{marginTop:0,border:0},onClick:()=>{var l;null==e||null===(l=e.onClickItem)||void 0===l||l.call(e,t.value,t)},children:[(0,d.jsx)(E.Z,{style:{fontSize:12,color:"#646A73",marginRight:5}}),(0,d.jsx)("span",{style:{flex:1},children:t.label})]},t.value))})}let Q=C.ZP.div(G()),$=C.ZP.div(U());function q(){let e=(0,S._)(["\n  display: flex;\n  align-items: center;\n  padding: 5px 10px;\n"]);return q=function(){return e},e}function H(e){let{field:t,label:l,default:i,value:o,tip:r,onChange:a,target:n,options:s=[]}=e;return(0,d.jsxs)("div",{style:{paddingTop:"10px"},children:[(0,d.jsxs)("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#333",display:"flex",alignItems:"center"},children:[(0,d.jsx)("div",{style:{flex:1},children:l}),(0,d.jsx)("div",{id:"".concat(t,"-right")})]}),(0,d.jsx)(_,{condition:null==s?void 0:s.length,children:(0,d.jsx)(y.Ph,{prefix:(0,d.jsx)(E.Z,{style:{color:"#666"}}),placeholder:"请选择",style:{width:"100%",marginTop:"5px"},onChange:e=>{a(n,t,e)},value:o,renderSelectedItem:e=>(0,d.jsx)("div",{children:(0,d.jsx)("div",{children:e.label===e.value?"":e.label})}),renderOptionItem:e=>(0,d.jsxs)(K,{style:{width:"97%",padding:"3px 8px",margin:"2px 5px",background:e.selected?"#f1f1fc":"",borderRadius:"4px"},onClick:e.onClick,children:[(0,d.jsx)(E.Z,{style:{color:"#666",marginRight:8}}),(0,d.jsx)("div",{children:e.label})]}),children:null==s?void 0:s.map((e,t)=>(0,d.jsx)(y.Ph.Option,{value:e.value,label:e.label},e.value))})}),(0,d.jsx)(_,{condition:!(null==s?void 0:s.length),children:(0,d.jsx)(y.Ph,{placeholder:"暂未选项",style:{width:"100%",marginTop:"5px"}})}),(0,d.jsx)("div",{style:{fontSize:"12px",marginTop:"2px",color:"#666"},children:r}),(0,d.jsx)("div",{id:t+"-bottom"})]})}let K=C.ZP.div(q());function Y(e){let{field:t,label:l,default:i,value:o,tip:r,onChange:n,target:s,options:c,portal:u}=e;return(0,a.useRef)(),B(u,(0,d.jsx)("div",{style:{marginTop:5},children:(0,d.jsx)(y.XZ,{checked:o,onChange:e=>{s[t]=e.target.checked,n(s,t,e.target.checked)},"aria-label":l,style:{fontSize:"12px",color:"#333"},children:l})}))}let ee={object:e=>eo,string:e=>x,"select-tabs":e=>w,"select-theme":e=>T,checkboxes:e=>L,line:()=>D,"field-list":e=>J,select:e=>H,"down-select":e=>V,checkbox:e=>Y};function et(e){let t=e.default;return"object"===e.type?(e.properties||[]).reduce((e,t)=>(t.field&&(e[t.field]=et(t)),e),t||{}):t}function el(e,t,l){let i=t.split("."),o=e;for(let e=0;e<i.length;e++){var r;let l=i[e],a=null===(r=o.properties)||void 0===r?void 0:r.find(e=>e.field===l);if(!a){console.error("未找到路径: ".concat(t));break}o=a}return Object.assign(o,l),{scheme:e,current:o}}function ei(e,t){let l=t.split("."),i=e;for(let e=0;e<l.length;e++){var o;let r=l[e],a=null===(o=i.properties)||void 0===o?void 0:o.find(e=>e.field===r);if(!a){console.error("未找到路径: ".concat(t));return}i=a}return i}function eo(e){let{properties:t,label:l,field:i,default:o,value:r,onChange:n,target:s,style:c}=e;return(null==t?void 0:t.length)?(0,d.jsxs)("div",{style:Object.assign({},c),children:[l&&(0,d.jsx)("div",{style:{marginBottom:"10px"},children:l}),null==t?void 0:t.map(e=>{var t;let l=(ee[t=e.type]||console.error("未找到注册的组件: ".concat(t)),ee[t]());return(0,a.createElement)(l,{...e,value:null==r?void 0:r[e.field],key:i+"."+e.field,target:r,onChange:(e,t,l)=>{e||(e={}),e[t]=l,n(s,i,e)}})})]}):(0,d.jsx)(d.Fragment,{})}var er=l(2454),ea=l.n(er);function en(e){return(0,a.useEffect)(()=>{var t;let l=et(e.scheme),i=e.value[e.scheme.field]?{[e.scheme.field]:e.value[e.scheme.field]}:{[e.scheme.field]:{}},o=ea()(l,i[e.scheme.field],{arrayMerge:(e,t)=>t});i[e.scheme.field]=o,console.log("ConfigUI onChange",l,o),null===(t=e.onChange)||void 0===t||t.call(e,e.value,e.scheme.field,o)},[e.scheme]),(0,d.jsx)(eo,{label:e.scheme.label,field:e.scheme.field,properties:e.scheme.properties,value:e.value[e.scheme.field],options:e.scheme.options,target:e.value,onChange:(t,l,i)=>{var o;null===(o=e.onChange)||void 0===o||o.call(e,t,l,i)}})}function es(e){return e.map(e=>({value:e.id,label:e.name,type:e.type}))}let ed=e=>{var t;let l=[{label:"以字段为类别，以记录聚合为系列",key:"fieldCategory",value:[{label:"类别",field:"cates",type:"field-list",options:{list:[]},default:[]},{label:"系列",field:"series",type:"select",options:[],default:[]},{portal:"#series-right",label:"计算方式",field:"calc",type:"down-select",options:[{label:"最大值",value:"MAX"},{label:"最小值",value:"MIN"},{label:"求和",value:"SUM"},{label:"平均值",value:"AVERAGE"}],default:"MAX"}]},{label:"以记录聚合为类别，以字段为系列",key:"recordCategory",value:[{label:"类别",field:"cate",type:"select"},{label:"系列",field:"series",type:"field-list"}]}];return{field:"root",type:"object",properties:[{field:"tableId",label:"数据源",type:"select",options:[]},{field:"dataRange",label:"数据范围",type:"select",options:[]},{field:"selectTheme",label:"主题色",type:"select-theme",default:"p1",options:f},{label:"图表选项",field:"chartOptions",type:"checkboxes",options:[{label:"图例",value:"showLegend"},{label:"数据标签",value:"showDataLabel"}],default:["showLegend","showDataLabel"]},{field:"",type:"line"},{label:"数据映射",field:"mapType",type:"select",options:l.map(e=>({label:e.label,value:e.key})),default:"fieldCategory"},{field:"mapOptions",type:"object",default:{},properties:null===(t=l.find(t=>t.key===e))||void 0===t?void 0:t.value}]}};function ec(){switch(s.getDashState()){case i.n3.View:return b({});case i.n3.FullScreen:return document.body.setAttribute("theme-mode","dark"),b({});default:return function(e){var t,l,o,r,n,c,u,f;let[p,g]=(0,m.$G)(),[b,x]=(0,a.useState)({root:{}}),[w,S]=(0,a.useState)({type:"object",field:""}),[C,j]=(0,a.useState)(!1),[I,T]=(0,a.useState)({}),k=(0,a.useRef)({});(0,a.useEffect)(()=>{(async function(){let e=O();if(!e)return;let t=await s.getPreviewData(e.dataConditions);console.log("getPreviewData",t),T(v(t,e.customConfig)),s.triggerDashRendered()})()},[b]),(0,a.useEffect)(()=>{async function e(){let e=await s.getConfig();console.log("getConfig",e),x({root:e.customConfig})}C&&(console.log("configValue",b),e())},[C]),(0,a.useEffect)(()=>{(async function(){let e=await s.getTableList();console.log("getTableList",e);let t=es(e),l=ed("fieldCategory");el(l,"tableId",{default:t[0].value,options:t}),S(l)})()},[]),(0,a.useEffect)(()=>{(async function(){let{tableId:e}=b.root;if(e){console.log("tableId",e);let t=es(await s.getViewList(e)).map(e=>({value:JSON.stringify({viewId:e.value,viewName:e.label,type:i.PO.VIEW}),label:e.label})),l=t[0].value;el(w,"dataRange",{options:t,default:l}),x({root:{...b.root,dataRange:l}}),S({...w})}})()},[null==b?void 0:null===(t=b.root)||void 0===t?void 0:t.tableId]),(0,a.useEffect)(()=>{(async function(){var e;if(console.log("updateFields",b.root.dataRange),!b.root.dataRange)return;let t=JSON.parse(b.root.dataRange),l=await s.getFiledListByViewId(b.root.tableId,t.viewId);console.log("getFieldList",l);let o=es(l);for(let e=0;e<o.length;e++){let t=o[e];k.current[t.value]=t.type}if((null==b?void 0:null===(e=b.root)||void 0===e?void 0:e.mapType)==="fieldCategory"){el(w,"mapOptions.cates",{options:{list:o.filter(e=>e.type===i.fS.Number)}}),el(w,"mapOptions.series",{options:o,default:o[0].value});let e=ei(w,"mapOptions");x({root:{...b.root,mapOptions:et(e)}})}else{el(w,"mapOptions.cate",{options:o,default:o[0].value}),el(w,"mapOptions.series",{options:{list:o.filter(e=>e.type===i.fS.Number),itemSelectOptions:[{label:"最大值",value:"MAX"},{label:"最小值",value:"MIN"},{label:"求和",value:"SUM"},{label:"平均值",value:"AVERAGE"}]},default:[]});let e=ei(w,"mapOptions");x({root:{...b.root,mapOptions:et(e)}})}S({...w}),j(!0)})()},[null==b?void 0:null===(l=b.root)||void 0===l?void 0:l.dataRange,null==b?void 0:null===(o=b.root)||void 0===o?void 0:o.mapType]),(0,a.useEffect)(()=>{S(e=>{let t=ei(ed(b.root.mapType),"mapOptions");return x({root:{...b.root,mapOptions:et(t)}}),el(e,"mapOptions",t),e})},[null==b?void 0:null===(r=b.root)||void 0===r?void 0:r.mapType]),(0,a.useEffect)(()=>{var e,t,l,o;if("fieldCategory"===b.root.mapType){let l=null==b?void 0:null===(t=b.root)||void 0===t?void 0:null===(e=t.mapOptions)||void 0===e?void 0:e.series;if(k.current[l]===i.fS.MultiSelect){let e=ei(w,"mapOptions");e.properties[2]={type:"checkbox",field:"checkSplit",label:"多项式拆分统计",default:!1,portal:"#series-bottom"},e.properties.length=3,S({...w})}else{let e=ei(w,"mapOptions");e&&(e.properties.length=2,S({...w}))}}else{let e=null==b?void 0:null===(o=b.root)||void 0===o?void 0:null===(l=o.mapOptions)||void 0===l?void 0:l.cate;if(k.current[e]===i.fS.MultiSelect){let e=ei(w,"mapOptions");e.properties[2]={type:"checkbox",field:"checkSplit",label:"多项式拆分统计",default:!1,portal:"#cate-bottom"},e.properties.length=3,S({...w})}else{let e=ei(w,"mapOptions");e&&(e.properties.length=2,S({...w}))}}},[null==b?void 0:null===(c=b.root)||void 0===c?void 0:null===(n=c.mapOptions)||void 0===n?void 0:n.cate,null==b?void 0:null===(f=b.root)||void 0===f?void 0:null===(u=f.mapOptions)||void 0===u?void 0:u.series]);let O=()=>{if(b.root.dataRange){if("fieldCategory"===b.root.mapType)return{dataConditions:{tableId:b.root.tableId,dataRange:JSON.parse(b.root.dataRange),groups:[{fieldId:b.root.mapOptions.series,sort:{order:i.zx.ASCENDING,sortType:i.FE.VIEW},mode:b.root.mapOptions.checkSplit?i.LM.ENUMERATED:i.LM.INTEGRATED}],series:b.root.mapOptions.cates.map(e=>({fieldId:e.value,rollup:b.root.mapOptions.calc}))},customConfig:b.root};if("recordCategory"===b.root.mapType){if(!b.root.mapOptions.series){console.error("series is empty");return}return{dataConditions:{tableId:b.root.tableId,dataRange:JSON.parse(b.root.dataRange),groups:[{fieldId:b.root.mapOptions.cate,sort:{order:i.zx.ASCENDING,sortType:i.FE.VIEW},mode:b.root.mapOptions.checkSplit?i.LM.ENUMERATED:i.LM.INTEGRATED}],series:b.root.mapOptions.series.map(e=>({fieldId:e.value,rollup:e.select}))},customConfig:b.root}}}};return(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"row",height:"100vh",overflow:"hidden",borderTop:"1px solid #eee"},children:[(0,d.jsx)("div",{style:{flex:1,padding:20},children:(0,d.jsx)(h,{option:I})}),(0,d.jsxs)("div",{style:{width:"30%",padding:"0 20px",overflow:"scroll",borderLeft:"1px solid #eee"},children:[(0,d.jsx)(en,{scheme:w,value:b,onChange:(e,t,l)=>{console.log("Root onChange",e,t,l),e[t]=l,x({...e})}}),(0,d.jsx)("div",{style:{height:200}}),(0,d.jsx)("div",{style:{position:"fixed",bottom:20,right:20,display:"flex",background:"#fff"},children:(0,d.jsx)(y.zx,{type:"primary",theme:"solid",style:{width:80},onClick:()=>{let e=O();if(!e){console.error("config is empty");return}s.saveConfig(e).then(e=>{console.log("setConfig",e)})},children:"确定"})})]})]})}(0)}}window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",function(e){let t=document.body;e.matches?t.hasAttribute("theme-mode")||t.setAttribute("theme-mode","dark"):t.hasAttribute("theme-mode")&&t.removeAttribute("theme-mode")})}}]);
//# sourceMappingURL=800.1690537057f446f4.js.map